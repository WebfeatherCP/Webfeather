# Webfeather — Техническая спецификация

## 1. Обзор проекта

Webfeather — лёгкая, модульная система управления сайтами на PHP с минимальными зависимостями и простой архитектурой.  
Цель — удобная настройка, расширяемость через модули и мультиязычность панели и модулей.

---

## 2. Настройка вебсервера

### 2.1 Рекомендуемые веб-серверы

- **Caddy** (рекомендуется за автоматический TLS и простоту конфигурации)  
- **NGINX** (альтернатива с высокой производительностью)

### 2.2 Пример конфигурации Caddy

```caddyfile
example.com {
    root * /path/to/webfeather/wf
    php_fastcgi unix//run/php/php-fpm.sock
    file_server
}
````

### 2.3 Пример конфигурации NGINX

```nginx
server {
    listen 80;
    server_name example.com;
    root /path/to/webfeather/wf;

    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/run/php/php-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

> [!WARNING]
> Расположение php-fpm.sock зависит от дистрибутива, проверьте свой!


---

## 3. Архитектура модулей

### 3.1 Структура модуля

Каждый модуль — PHP-файл в папке `modules/`, содержащий массив `$module` с ключами:

* `route` — строка, маршрут для вызова (например, `login`, `shop`)
* `name` — человекочитаемое имя модуля
* `render` — анонимная функция без аргументов, которая отвечает за вывод содержимого модуля

### 3.2 Пример модуля

```php
<?php
$module = [
    'route' => 'example',
    'name' => 'Пример модуля',
    'render' => function() {
        echo "<h2>Привет из модуля!</h2>";
    }
];
```

### 3.3 Маршрутизация

* URL с параметром `?{route}` вызывает соответствующий модуль по ключу `route`
* При отсутствии параметра — показывается основной экран (например, `main`)

---

## 4. Работа с языковыми пакетами

### 4.1 Расположение

Папка `lang/` рядом с `Webfeather.php`. В ней лежат языковые файлы в формате PHP с массивом переводов:

```
lang/
  ├── en.php
  ├── ru.php
  └── ... 
```

### 4.2 Формат файла языка

```php
<?php
return [
    'modules_not_found'=>'Модули не найдены',
    'welcome_title' => 'Добро пожаловать в Webfeather',
    // другие ключи и переводы
];
```

### 4.3 Использование в ядре и модулях

* При инициализации загружается массив с переводами для выбранного языка
* В модулях и шаблонах используются ключи для вывода текста, например:

```php
<?= $lang['welcome_title'] ?>
```

### 4.4 Стандартизация ключей и организация переводов в модулях

Для удобства поддержки и масштабирования мультиязычности в Webfeather **рекомендуется стандартизировать структуру языковых файлов и ключей переводов для всех модулей**.

#### Организация файлов модуля

* Каждый модуль — это папка с именем модуля, например, `modules/login/`
* Внутри папки модуля могут располагаться дополнительные поддиректории для логической организации:

  * `lang/` — языковые файлы модуля
  * `config/` — конфигурационные файлы модуля
  * `lib/` — вспомогательные библиотеки и классы модуля
* Такая структура **не обязательна**, но **рекомендуется** для удобства поддержки и масштабируемости.

#### Формат языковых файлов модуля

* В папке `lang/` модуля лежат файлы с названиями, соответствующими языковым кодам, например:

  ```
  modules/login/lang/en.php
  modules/login/lang/ru.php
  ```
* Каждый файл возвращает массив ключей и переводов, например:

  ```php
  <?php
  return [
      'login_title' => 'Login',
      'login_button' => 'Sign In',
      'error_invalid' => 'Invalid username or password',
  ];
  ```
* Ключи должны быть уникальными внутри модуля и отражать контекст, например, начинаться с префикса `login_`.

#### Использование языковых файлов в модулях

* При загрузке модуля система должна подгрузить нужный языковой файл, соответствующий выбранному языку пользователя (например, из `$_SESSION['lang']` или по умолчанию `en`).
* Переводы из модуля объединяются с глобальными переводами Webfeather, чтобы приоритет был на модулях в их контексте.
* Для вывода текста в модуле используется массив переводов:

  ```php
  echo $moduleLang['login_title'];
  ```

#### Будущее развитие мультиязычности

* На момент релиза 1.0 в Webfeather **нет строгой проверки** и автоматического выбора языка для модулей.
* Планируется реализовать механизм, где язык интерфейса панели и модулей будет храниться в сессии пользователя:

  ```php
  $_SESSION['lang'] = 'ru'; // или 'en', 'de' и т.д.
  ```
* Это позволит динамически подгружать нужные языковые файлы без перезагрузки или изменения кода.
* В будущем планируется добавить в ядро Webfeather централизованную систему управления языками и поддержку fallback-языков (например, если нет перевода на выбранном языке — брать английский).

---

## 5. Безопасность и сессии

* Использовать `session_start()` в модулях, где требуется аутентификация
* Проверять права пользователя по сессии (например, `$_SESSION['group'] === 'admin'`)
* Хранить пароли в хэшированном виде (например, `password_hash()` и `password_verify()`)
* Ограничивать доступ к модулям по правам

---

## 6. Настройка и расширение

* Добавлять новые модули достаточно положить файл в `modules/` с корректным `$module`
* Добавлять новые языки — создать новый файл в `lang/` с переводами
* Конфигурационные параметры хранить в отдельном файле или массиве внутри ядра

---

## 7. Хранение данных

* По умолчанию — использование сессий и простых файлов, SQLite или Redis для расширенных задач
* База данных должна быть защищена от прямого доступа через веб (через конфигурацию вебсервера)

---

## 8. Логирование

* Рекомендуется реализовать простой лог запросов и ошибок для диагностики
* Логи должны сохраняться вне публичного доступа

---

# Конец спецификации
